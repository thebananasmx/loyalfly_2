<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loyalfly - Cartera de Lealtad</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <meta name="theme-color" content="#34D399">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./images/icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Loyalfly">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#18181B', 'dark-surface': '#27272A', 'menta': '#34D399',
                        'oro-suave': '#FBBF24', 'light-text': '#F4F4F5', 'subtle-text': '#A1A1AA',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #18181B; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        ::placeholder { color: #52525B; }
        #splash-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: #18181B; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease-out; }
        #splash-screen.hidden { opacity: 0; pointer-events: none; }

        /* View transition styles */
        #auth-container, #app-container {
            position: relative;
        }
        #auth-container > div, #app-container > div {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            pointer-events: none;
            transform: translateY(15px); /* Start slightly below */
        }

        /* Active view is visible and interactive */
        #auth-container > div.active, #app-container > div.active {
            opacity: 1;
            pointer-events: auto;
            position: relative; /* Let it define the height of the container */
            transform: translateY(0);
        }
    </style>
</head>
<body class="text-light-text antialiased">

    <div id="splash-screen">
        <h1 id="splash-title" class="text-5xl font-bold text-menta">Loyalfly</h1>
        <p id="splash-subtitle" class="text-subtle-text mt-2">Cargando tu cartera...</p>
    </div>

    <div id="app" class="max-w-md mx-auto min-h-screen bg-dark-bg shadow-lg">

        <!-- VISTAS DE AUTENTICACIÓN -->
        <div id="auth-container">
            <!-- VISTA: LOGIN DE CLIENTE -->
            <div id="client-login-view" class="active flex flex-col items-center justify-center min-h-screen p-8">
                <h1 class="text-5xl font-bold text-menta mb-2">Loyalfly</h1>
                <p class="text-subtle-text mb-12">Tu cartera de lealtad digital.</p>
                <div class="w-full">
                    <label for="phone-input" class="block text-sm font-medium text-subtle-text mb-2">Tu número de teléfono</label>
                    <div class="relative rounded-md shadow-sm">
                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"><span class="text-subtle-text sm:text-sm">+52</span></div>
                        <input type="tel" id="phone-input" class="block w-full rounded-lg bg-dark-surface border-dark-surface pl-12 py-3 focus:border-menta focus:ring-menta sm:text-lg" autocomplete="tel">
                    </div>
                </div>
                <button id="login-btn" class="w-full bg-menta text-dark-bg py-3 px-4 mt-6 rounded-lg font-bold text-lg shadow-md hover:bg-green-300 transition ease-in-out duration-300">Consultar Mis Tarjetas</button>
                <div class="mt-8 text-center">
                    <p class="text-sm text-subtle-text">¿No tienes cuenta? <a href="#" id="go-to-register" class="font-semibold text-menta hover:underline">Regístrate aquí</a></p>
                    <a href="#" id="go-to-business-login" class="text-sm text-menta hover:underline mt-2 inline-block">Soy un negocio</a>
                </div>
            </div>

            <!-- VISTA: REGISTRO DE CLIENTE -->
            <div id="registration-view" class="flex flex-col items-center justify-center min-h-screen p-8">
                <h1 class="text-3xl font-bold text-menta mb-2">Registro Nuevo</h1>
                <p class="text-subtle-text mb-8">Crea tu cuenta para ganar recompensas.</p>
                <div class="w-full space-y-4">
                    <div>
                        <label for="register-name-input" class="block text-sm font-medium text-subtle-text mb-2">Nombre completo</label>
                        <input type="text" id="register-name-input" class="block w-full rounded-lg bg-dark-surface border-dark-surface py-3 px-4 focus:border-menta focus:ring-menta sm:text-lg" placeholder="Ej. Ana Torres" autocomplete="name">
                    </div>
                    <div>
                        <label for="register-phone-input" class="block text-sm font-medium text-subtle-text mb-2">Tu número de teléfono</label>
                        <div class="relative rounded-md shadow-sm">
                            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"><span class="text-subtle-text sm:text-sm">+52</span></div>
                            <input type="tel" id="register-phone-input" class="block w-full rounded-lg bg-dark-surface border-dark-surface pl-12 py-3 focus:border-menta focus:ring-menta sm:text-lg" placeholder="55 1234 5678" autocomplete="tel">
                        </div>
                    </div>
                </div>
                <button id="register-btn" class="w-full bg-menta text-dark-bg py-3 px-4 mt-6 rounded-lg font-bold text-lg shadow-md hover:bg-green-300 transition ease-in-out duration-300">Registrarme</button>
                <div class="mt-8 text-center"><a href="#" id="go-to-login" class="text-sm text-menta hover:underline">Ya tengo una cuenta</a></div>
            </div>
            
            <!-- VISTA: LOGIN DE NEGOCIO -->
            <div id="business-login-view" class="flex flex-col items-center justify-center min-h-screen p-8">
                <h1 class="text-3xl font-bold text-menta mb-2">Acceso de Negocio</h1>
                <p class="text-subtle-text mb-8">Inicia sesión para administrar tus clientes.</p>
                <div class="w-full space-y-4">
                    <div>
                        <label for="business-email-login" class="block text-sm font-medium text-subtle-text mb-2">Correo electrónico</label>
                        <input type="email" id="business-email-login" class="block w-full rounded-lg bg-dark-surface border-dark-surface py-3 px-4 focus:border-menta focus:ring-menta sm:text-lg" autocomplete="email">
                    </div>
                    <div>
                        <label for="business-password-login" class="block text-sm font-medium text-subtle-text mb-2">Contraseña</label>
                        <input type="password" id="business-password-login" class="block w-full rounded-lg bg-dark-surface border-dark-surface py-3 px-4 focus:border-menta focus:ring-menta sm:text-lg" autocomplete="current-password">
                    </div>
                </div>
                <button id="business-login-btn" class="w-full bg-menta text-dark-bg py-3 px-4 mt-6 rounded-lg font-bold text-lg shadow-md hover:bg-green-300 transition">Iniciar Sesión</button>
                <div class="mt-8 text-center">
                    <p class="text-sm text-subtle-text">¿No tienes cuenta? <a href="#" id="go-to-business-register" class="font-semibold text-menta hover:underline">Regístrate aquí</a></p>
                    <a href="#" id="go-to-client-login-from-business" class="text-sm text-menta hover:underline mt-2 inline-block">Soy un cliente</a>
                </div>
            </div>

            <!-- VISTA: REGISTRO DE NEGOCIO -->
            <div id="business-register-view" class="flex flex-col items-center justify-center min-h-screen p-8">
                <h1 class="text-3xl font-bold text-menta mb-2">Registro de Negocio</h1>
                <p class="text-subtle-text mb-8">Crea una cuenta para tu negocio.</p>
                <div class="w-full space-y-4">
                     <div>
                        <label for="business-name-register" class="block text-sm font-medium text-subtle-text mb-2">Nombre del Negocio</label>
                        <input type="text" id="business-name-register" class="block w-full rounded-lg bg-dark-surface border-dark-surface py-3 px-4 focus:border-menta focus:ring-menta sm:text-lg" autocomplete="organization">
                    </div>
                    <div>
                        <label for="business-email-register" class="block text-sm font-medium text-subtle-text mb-2">Correo Electrónico</label>
                        <input type="email" id="business-email-register" class="block w-full rounded-lg bg-dark-surface border-dark-surface py-3 px-4 focus:border-menta focus:ring-menta sm:text-lg" autocomplete="email">
                    </div>
                    <div>
                        <label for="business-password-register" class="block text-sm font-medium text-subtle-text mb-2">Contraseña</label>
                        <input type="password" id="business-password-register" class="block w-full rounded-lg bg-dark-surface border-dark-surface py-3 px-4 focus:border-menta focus:ring-menta sm:text-lg" autocomplete="new-password">
                    </div>
                </div>
                <button id="business-register-btn" class="w-full bg-menta text-dark-bg py-3 px-4 mt-6 rounded-lg font-bold text-lg shadow-md hover:bg-green-300 transition">Crear Cuenta de Negocio</button>
                <div class="mt-8 text-center"><a href="#" id="go-to-business-login-from-register" class="text-sm text-menta hover:underline">Ya tengo una cuenta</a></div>
            </div>
        </div>

        <!-- VISTAS DE LA APLICACIÓN (USUARIO LOGUEADO) -->
        <div id="app-container" class="hidden">
            <!-- VISTA: DASHBOARD DE TARJETAS DE CLIENTE -->
            <div id="dashboard-view" class="flex flex-col h-screen">
                <header class="sticky top-0 bg-dark-bg/80 backdrop-blur-sm p-4 border-b border-dark-surface flex justify-between items-center"><h1 class="text-2xl font-bold text-menta">Loyalfly</h1><button id="client-logout-btn" class="text-sm text-menta hover:underline">Salir</button></header>
                <main id="cards-container" class="flex-grow overflow-y-auto p-4 space-y-4 no-scrollbar pb-20"></main>
            </div>

            <!-- VISTA: CAJERO -->
            <div id="cashier-view" class="flex flex-col h-screen relative">
                <header class="sticky top-0 bg-dark-bg/80 backdrop-blur-sm p-4 border-b border-dark-surface flex justify-between items-center">
                    <div><h1 class="text-2xl font-bold text-menta" id="business-name-header"></h1><p class="text-sm text-subtle-text">Panel de Cajero</p></div>
                    <div class="flex items-center">
                        <button id="reward-config-btn" class="text-menta p-2 rounded-full hover:bg-dark-surface"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                        <button id="cashier-logout-btn" class="text-sm text-menta hover:underline ml-4">Salir</button>
                    </div>
                </header>
                <main id="clients-list-container" class="flex-grow overflow-y-auto p-2 no-scrollbar pb-20"></main>
                <button id="add-client-fab" class="absolute bottom-6 right-6 bg-menta text-dark-bg rounded-full p-4 shadow-lg hover:bg-green-300 transition-transform transform hover:scale-110">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                </button>
            </div>
        </div>

        <!-- MODALES -->
        <div id="otp-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-40">
            <div class="bg-dark-surface rounded-lg shadow-xl p-8 w-full max-w-sm text-center">
                <h2 class="text-xl font-bold text-menta mb-2">Verificación</h2>
                <p class="text-subtle-text mb-6">Ingresa el código que te enviamos por SMS.</p>
                <input type="text" id="otp-input" class="w-full text-center text-2xl tracking-[1em] rounded-lg bg-dark-bg border-dark-surface py-3 focus:border-menta focus:ring-menta" maxlength="6" placeholder="------" autocomplete="one-time-code">
                <button id="otp-verify-btn" class="w-full bg-menta text-dark-bg py-3 px-4 mt-6 rounded-lg font-bold text-lg shadow-md hover:bg-green-300 transition">Verificar</button>
            </div>
        </div>
        <div id="reward-config-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-40">
            <div class="bg-dark-surface rounded-lg shadow-xl p-8 w-full max-w-sm">
                <h2 class="text-xl font-bold text-menta mb-4">Configurar Recompensa</h2>
                <div class="space-y-4">
                    <div><label for="reward-title" class="block text-sm font-medium text-subtle-text">Título de la Recompensa</label><input type="text" id="reward-title" class="mt-1 block w-full rounded-md bg-dark-bg border-dark-surface shadow-sm focus:border-menta focus:ring-menta"></div>
                    <div><label for="reward-description" class="block text-sm font-medium text-subtle-text">Descripción Detallada</label><textarea id="reward-description" rows="3" class="mt-1 block w-full rounded-md bg-dark-bg border-dark-surface shadow-sm focus:border-menta focus:ring-menta"></textarea></div>
                    <div><label for="stamps-required" class="block text-sm font-medium text-subtle-text">Sellos Requeridos</label><input type="number" id="stamps-required" class="mt-1 block w-full rounded-md bg-dark-bg border-dark-surface shadow-sm focus:border-menta focus:ring-menta"></div>
                    <div>
                        <label class="block text-sm font-medium text-subtle-text">Color de la Tarjeta</label>
                        <div class="mt-2 flex items-center space-x-3">
                            <div id="color-swatches" class="flex flex-wrap gap-2">
                                <button data-color="#27272A" class="h-8 w-8 rounded-full border-2 border-transparent" style="background-color: #27272A;" aria-label="Gris Oscuro"></button>
                                <button data-color="#57534E" class="h-8 w-8 rounded-full border-2 border-transparent" style="background-color: #57534E;" aria-label="Piedra"></button>
                                <button data-color="#1E40AF" class="h-8 w-8 rounded-full border-2 border-transparent" style="background-color: #1E40AF;" aria-label="Azul Intenso"></button>
                                <button data-color="#BE123C" class="h-8 w-8 rounded-full border-2 border-transparent" style="background-color: #BE123C;" aria-label="Rojo Carmesí"></button>
                                <button data-color="#0F766E" class="h-8 w-8 rounded-full border-2 border-transparent" style="background-color: #0F766E;" aria-label="Verde Teal"></button>
                                <button data-color="#86198F" class="h-8 w-8 rounded-full border-2 border-transparent" style="background-color: #86198F;" aria-label="Púrpura"></button>
                                <button data-color="#B45309" class="h-8 w-8 rounded-full border-2 border-transparent" style="background-color: #B45309;" aria-label="Ámbar"></button>
                            </div>
                            <label for="custom-color-picker" class="relative h-8 w-8 rounded-full border-2 border-subtle-text cursor-pointer flex items-center justify-center shrink-0" aria-label="Seleccionar color personalizado">
                                <div id="custom-color-preview" class="w-full h-full rounded-full"></div>
                                <svg xmlns="http://www.w3.org/2000/svg" class="absolute h-5 w-5 text-white/80 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v2a2 2 0 01-2 2H5zM14 3h4a2 2 0 012 2v4m0 8v4a2 2 0 01-2 2h-4a2 2 0 01-2-2v-2a2 2 0 012-2h4z"></path>
                                </svg>
                                <input type="color" id="custom-color-picker" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                            </label>
                        </div>
                        <input type="hidden" id="card-color-input" value="#27272A">
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3"><button id="cancel-reward-btn" class="bg-zinc-600 text-light-text py-2 px-4 rounded-lg hover:bg-zinc-500 transition">Cancelar</button><button id="save-reward-btn" class="bg-menta text-dark-bg font-semibold py-2 px-4 rounded-lg hover:bg-green-300 transition">Guardar</button></div>
            </div>
        </div>
         <div id="add-client-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-40">
            <div class="bg-dark-surface rounded-lg shadow-xl p-8 w-full max-w-sm">
                <h2 class="text-xl font-bold text-menta mb-4">Añadir Nuevo Cliente</h2>
                <div class="space-y-4">
                    <div>
                        <label for="add-client-name" class="block text-sm font-medium text-subtle-text">Nombre completo del cliente</label>
                        <input type="text" id="add-client-name" class="mt-1 block w-full rounded-md bg-dark-bg border-dark-surface shadow-sm focus:border-menta focus:ring-menta" autocomplete="name">
                    </div>
                    <div>
                        <label for="add-client-phone" class="block text-sm font-medium text-subtle-text">Teléfono (10 dígitos)</label>
                        <div class="relative rounded-md shadow-sm">
                            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"><span class="text-subtle-text sm:text-sm">+52</span></div>
                            <input type="tel" id="add-client-phone" class="block w-full rounded-lg bg-dark-bg border-dark-surface pl-12 py-3 focus:border-menta focus:ring-menta sm:text-lg" autocomplete="tel">
                        </div>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button id="cancel-add-client-btn" class="bg-zinc-600 text-light-text py-2 px-4 rounded-lg hover:bg-zinc-500 transition">Cancelar</button>
                    <button id="save-add-client-btn" class="bg-menta text-dark-bg font-semibold py-2 px-4 rounded-lg hover:bg-green-300 transition">Añadir Cliente</button>
                </div>
            </div>
        </div>
        <div id="alert-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
            <div class="relative bg-dark-surface rounded-lg shadow-xl p-6 w-full max-w-sm text-center">
                <button id="alert-close-btn" class="absolute top-3 right-3 text-subtle-text hover:text-light-text transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <div id="alert-icon-container" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-menta mb-4"><svg id="alert-icon-svg" class="h-6 w-6 text-dark-bg" fill="none" viewBox="0 0 24 24" stroke="currentColor"></svg></div>
                <h2 id="alert-title" class="text-xl font-bold text-light-text mb-2">Aviso</h2>
                <p id="alert-message" class="text-subtle-text mb-6 px-4">Mensaje de la alerta.</p>
                <button id="alert-ok-btn" class="w-full bg-menta text-dark-bg py-2 px-4 rounded-lg font-bold text-lg shadow-md hover:bg-green-300 transition">Aceptar</button>
            </div>
        </div>
    </div>
    
    <!-- Contenedor para reCAPTCHA, necesario para la verificación por SMS -->
    <div id="recaptcha-container"></div>

    <script type="module" src="./index.tsx"></script>
</body>
</html>